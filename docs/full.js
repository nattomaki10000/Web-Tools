javascript:(function(){(function(){const JSZIP_CDN='https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js';const PROXY_LIST=['https://corsproxy.io/?','https://api.allorigins.win/raw?url=','https://r.jina.ai/http://'];const MAX_FETCH_CONCURRENCY=6;function $el(t,a,...c){const e=document.createElement(t);if(a)for(const k in a){if(k==='style')Object.assign(e.style,a[k]);else if(k.startsWith('on'))e.addEventListener(k.slice(2),a[k]);else e.setAttribute(k,a[k]);}for(const x of c)if(x!=null)typeof x==='string'||typeof x==='number'?e.appendChild(document.createTextNode(String(x))):e.appendChild(x);return e;}function basename(url){try{return decodeURIComponent((new URL(url,location.href)).pathname.split('/').filter(Boolean).pop()||url.split('/').pop());}catch(e){return url.split('/').pop()||url;}}function sleep(ms){return new Promise(r=>setTimeout(r,ms));}function ensureJSZip(){if(window.JSZip)return Promise.resolve(window.JSZip);return new Promise((res,rej)=>{const s=document.createElement('script');s.src=JSZIP_CDN;s.onload=()=>res(window.JSZip);s.onerror=()=>rej(new Error('Failed to load JSZip'));document.head.appendChild(s);});}function downloadBlob(blob,filename){const a=document.createElement('a');const url=URL.createObjectURL(blob);a.href=url;a.download=filename||'download';document.body.appendChild(a);a.click();setTimeout(()=>{URL.revokeObjectURL(url);a.remove();},15000);}function downloadURL(url,filename){const a=document.createElement('a');a.href=url;a.download=filename||'';a.target='_blank';document.body.appendChild(a);a.click();a.remove();}async function fetchWithTimeout(resource,options={},timeout=20000){const controller=new AbortController();const id=setTimeout(()=>controller.abort(),timeout);try{const res=await fetch(resource,{...options,signal:controller.signal});clearTimeout(id);return res;}catch(e){clearTimeout(id);throw e;}}async function parallelLimit(tasks,limit=MAX_FETCH_CONCURRENCY){const results=[];const executing=[];for(const t of tasks){const p=Promise.resolve().then(()=>t());results.push(p);executing.push(p);p.then(()=>executing.splice(executing.indexOf(p),1));if(executing.length>=limit)await Promise.race(executing);}return Promise.all(results);}const START_BTN_ID='asset-exporter-start-btn';function injectStartButton(){const old=document.getElementById(START_BTN_ID);if(old)old.remove();const btn=$el('button',{id:START_BTN_ID},'START MENU');Object.assign(btn.style,{position:'fixed',zIndex:2147483647,top:'18px',right:'18px',padding:'10px 14px',fontSize:'15px',borderRadius:'8px',border:'2px solid #222',background:'white',color:'#111',boxShadow:'0 6px 18px rgba(0,0,0,0.15)'});btn.onclick=()=>{btn.remove();openMainMenu();};document.body.appendChild(btn);}function menuPrompt(title,options){let msg=title+'\n';for(let i=0;i<options.length;i++)msg+=(i+1)+'. '+options[i]+'\n';const s=prompt(msg,'');if(!s)return null;const n=parseInt(s);if(isNaN(n)||n<1||n>options.length)return null;return n;}const PANEL_ID='asset-exporter-panel';function createPanel(){const old=document.getElementById(PANEL_ID);if(old)old.remove();const panel=$el('div',{id:PANEL_ID});Object.assign(panel.style,{position:'fixed',zIndex:2147483647,left:'6%',top:'6%',width:'88%',maxHeight:'86%',overflow:'auto',background:'#fff',border:'2px solid #333',borderRadius:'10px',padding:'12px',boxShadow:'0 12px 30px rgba(0,0,0,0.25)',fontFamily:'system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial',color:'#111'});const header=$el('div',null,$el('strong',null,'Asset Exporter — Panel'),$el('span',{style:{marginLeft:'10px',fontSize:'12px',color:'#666'}},'(CORS may block external fetch)'));const closeBtn=$el('button',{style:{float:'right'},onclick:()=>panel.remove()},'Close');header.appendChild(closeBtn);const content=$el('div',{id:PANEL_ID+'-content',style:{marginTop:'8px'}});panel.appendChild(header);panel.appendChild(content);document.body.appendChild(panel);return content;}async function scanCurrentPage(){const assets=[];assets.push({type:'html',name:(document.location.pathname.split('/').pop()||'index.html'),url:location.href,inline:false,content:null});document.querySelectorAll('script').forEach((s,i)=>{if(s.src)assets.push({type:'js',name:basename(s.src),url:s.src,inline:false});else assets.push({type:'js-inline',name:`inline-script-${i+1}.js`,content:s.textContent||'',inline:true});});document.querySelectorAll('link[rel~=\"stylesheet\"]').forEach((l,i)=>{if(l.href)assets.push({type:'css',name:basename(l.href),url:l.href,inline:false});});document.querySelectorAll('style').forEach((st,i)=>{assets.push({type:'css-inline',name:`inline-style-${i+1}.css`,content:st.textContent||'',inline:true});});document.querySelectorAll('img').forEach((img,i)=>{const u=img.currentSrc||img.src||img.getAttribute('data-src');if(u)assets.push({type:'image',name:basename(u),url:u,inline:false});});document.querySelectorAll('video,audio,source').forEach((el,i)=>{const u=el.src||el.getAttribute('src')||el.getAttribute('data-src');if(u)assets.push({type:'media',name:basename(u),url:u,inline:false});});document.querySelectorAll('a').forEach(a=>{const href=a.href; if(href&&href.startsWith('http')) assets.push({type:'link',name:basename(href),url:href,inline:false});});try{for(const ss of document.styleSheets){let rules;try{rules=ss.cssRules;}catch(e){continue;}if(!rules)continue;for(const r of rules){const txt=r.cssText||'';if(/url\\(/.test(txt)){const matches=[...txt.matchAll(/url\\((?:'|\")?([^'\"\\)]+)(?:'|\")?\\)/g)].map(m=>m[1]);for(const m of matches){if(!m||m.startsWith('data:'))continue;const abs=new URL(m,ss.href||location.href).href;assets.push({type:'css-resource',name:basename(abs),url:abs,inline:false});}}if(r.type===5){const mm=[...r.cssText.matchAll(/url\\((?:'|\")?([^'\"\\)]+)(?:'|\")?\\)/g)].map(m=>m[1]);for(const u of mm){if(!u||u.startsWith('data:'))continue;const abs=new URL(u,ss.href||location.href).href;assets.push({type:'font',name:basename(abs),url:abs,inline:false});}}}}}catch(e){}const seen=new Set();const out=[];for(const a of assets){if(a.url){if(seen.has(a.url))continue;seen.add(a.url);}out.push(a);}return out;}function renderAssetsListPanel(assets,title){const container=createPanel();container.innerHTML='';container.appendChild($el('div',null,$el('strong',null,title||'Assets List')));const listWrap=$el('div',{style:{marginTop:'8px',maxHeight:'60vh',overflow:'auto'}});assets.forEach((a,idx)=>{const row=$el('div',{style:{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'6px 4px',borderBottom:'1px dashed #eee'}});const info=$el('div',{style:{flex:'1 1 70%'}},$el('div',{style:{fontSize:'13px',color:'#111'}},`${idx+1}. ${a.type} — ${a.name || '(no name)'} ${a.inline? '(inline)':''}`),$el('div',{style:{fontSize:'12px',color:'#666',wordBreak:'break-all'}},a.url||(a.content?'inline content':'')));const controls=$el('div',{style:{display:'flex',gap:'6px',alignItems:'center'}});const dlBtn=$el('button',{onclick:()=>{if(a.inline){const blob=new Blob([a.content||''],{type:'text/plain'});downloadBlob(blob,a.name||'inline.txt');}else{fetchAndDownload(a.url,a.name||basename(a.url));}}},'Download');controls.appendChild(dlBtn);if(!a.inline&&a.url){const openBtn=$el('button',{onclick:()=>window.open(a.url,'_blank')},'Open');controls.appendChild(openBtn);}row.appendChild(info);row.appendChild(controls);listWrap.appendChild(row);});container.appendChild(listWrap);const zipBtn=$el('button',{style:{marginTop:'10px'},onclick:()=>zipAssetsAndDownload(assets)},'Download ALL as ZIP');container.appendChild(zipBtn);container.appendChild($el('div',{style:{marginTop:'8px',color:'#a00',fontSize:'12px'}},'Note: external resources may be blocked by CORS; such files will be skipped.'));}async function tryFetchWithProxies(url,timeout=20000){try{const resp=await fetchWithTimeout(url,{},timeout);if(resp.ok)return resp;}catch(e){}for(const p of PROXY_LIST){const proxyUrl=p+encodeURIComponent(url);try{const resp=await fetchWithTimeout(proxyUrl,{},timeout);if(resp.ok)return resp;}catch(e){} }throw new Error('All fetch attempts failed (direct+proxies)');}async function fetchAndDownload(url,name){try{const resp=await fetchWithTimeout(url);if(!resp.ok)throw new Error('HTTP '+resp.status);const blob=await resp.blob();downloadBlob(blob,name||basename(url));}catch(e){const useProxy=confirm('Direct fetch failed for:\\n'+url+'\\nTry using public CORS proxies? (May expose the request to third parties)');if(!useProxy){alert('Download canceled.');return;}try{const resp=await tryFetchWithProxies(url);const blob=await resp.blob();downloadBlob(blob,name||basename(url));}catch(err){alert('Failed even with proxies: '+(err.message||err));}}}async function zipAssetsAndDownload(assets){const JSZipObj=await ensureJSZip().catch(()=>null);if(!JSZipObj){alert('Failed to load JSZip from CDN. Check network.');return;}const zip=new JSZipObj();const folder=zip.folder('assets_export');assets.filter(a=>a.inline).forEach(a=>folder.file(a.name||( 'inline-'+Date.now()),a.content||''));const tasks=assets.filter(a=>!a.inline&&a.url).map(a=>async ()=>{try{const resp=await fetchWithTimeout(a.url,{},20000);if(!resp.ok)throw new Error('HTTP '+resp.status);const blob=await resp.blob();try{const u=new URL(a.url);const path=(u.pathname.startsWith('/')?u.pathname.slice(1):u.pathname)||a.name||basename(a.url);folder.file(path,blob);}catch(e){folder.file(a.name||basename(a.url),blob);}return {ok:true,url:a.url};}catch(e){for(const p of PROXY_LIST){try{const resp=await fetchWithTimeout(p+encodeURIComponent(a.url),{},20000);if(resp.ok){const blob=await resp.blob();folder.file(a.name||basename(a.url),blob);return {ok:true,url:a.url,via:p};}}catch(_){} }return {ok:false,url:a.url,error:String(e)};}});const results=await parallelLimit(tasks,MAX_FETCH_CONCURRENCY);const failed=results.filter(r=>!r.ok);const blob=await zip.generateAsync({type:'blob'});downloadBlob(blob,(document.title||'page')+'-assets.zip');if(failed.length){alert('Some assets failed to download (CORS/404). See console for details.');console.warn('Asset fetch failures:',failed);} }async function fetchPageAndExtractAssets(url,tryUseProxyIfFail=true){let html=null;try{const resp=await fetchWithTimeout(url,{},20000);if(!resp.ok)throw new Error('HTTP '+resp.status);html=await resp.text();}catch(e){if(!tryUseProxyIfFail)throw e;const useProxy=confirm('Direct fetch failed for URL. Try public CORS proxies? (May expose request to third parties)');if(!useProxy)throw e;for(const p of PROXY_LIST){try{const resp=await fetchWithTimeout(p+encodeURIComponent(url),{},20000);if(resp.ok){html=await resp.text();break;}}catch(_){} }if(!html)throw new Error('Failed to fetch via proxies too.');}const parser=new DOMParser();const doc=parser.parseFromString(html,'text/html');const assets=[];assets.push({type:'html',name:'index.html',url:url,inline:true,content:html});doc.querySelectorAll('script').forEach((s,i)=>{if(s.src)assets.push({type:'js',name:basename(s.src),url:new URL(s.src,url).href,inline:false});else assets.push({type:'js-inline',name:`inline-script-${i+1}.js`,content:s.textContent||'',inline:true});});doc.querySelectorAll('link[rel~=\"stylesheet\"]').forEach((l,i)=>{if(l.href)assets.push({type:'css',name:basename(l.href),url:new URL(l.href,url).href,inline:false});});doc.querySelectorAll('img').forEach((img,i)=>{const u=img.getAttribute('src')||img.getAttribute('data-src')||img.src;if(u)assets.push({type:'image',name:basename(u),url:new URL(u,url).href,inline:false});});doc.querySelectorAll('video,audio,source').forEach((el,i)=>{const u=el.getAttribute('src')||el.src;if(u)assets.push({type:'media',name:basename(u),url:new URL(u,url).href,inline:false});});doc.querySelectorAll('style').forEach(st=>{const txt=st.textContent||'';const matches=[...txt.matchAll(/url\\((?:'|\")?([^'\"\\)]+)(?:'|\")?\\)/g)].map(m=>m[1]);for(const m of matches){if(!m||m.startsWith('data:'))continue;assets.push({type:'css-resource',name:basename(m),url:new URL(m,url).href,inline:false});}});const seen=new Set();const out=[];for(const a of assets){if(a.url){if(seen.has(a.url))continue;seen.add(a.url);}out.push(a);}return out;}async function webSee(url){try{const assets=await fetchPageAndExtractAssets(url);const blobMap={};const tasks=assets.filter(a=>!a.inline&&a.url).map(a=>async ()=>{try{const resp=await fetchWithTimeout(a.url,{},20000);if(!resp.ok)throw new Error('HTTP '+resp.status);const blob=await resp.blob();blobMap[a.url]=URL.createObjectURL(blob);return {ok:true};}catch(e){for(const p of PROXY_LIST){try{const resp=await fetchWithTimeout(p+encodeURIComponent(a.url),{},20000);if(resp.ok){const blob=await resp.blob();blobMap[a.url]=URL.createObjectURL(blob);return {ok:true,via:p};}}catch(_){} }return {ok:false,url:a.url,error:String(e)};}});await parallelLimit(tasks,MAX_FETCH_CONCURRENCY);const htmlAsset=assets.find(a=>a.type==='html');if(!htmlAsset){alert('No HTML found.');return;}let html=htmlAsset.content||'';for(const orig in blobMap){const b=blobMap[orig];html=html.split(orig).join(b);}const win=window.open();if(!win){alert('Popup blocked. Allow popups and try again.');return;}win.document.open();win.document.write(html);win.document.close();}catch(e){alert('Web See failed: '+(e.message||e));}}function openHTMLToolPanel(){const content=createPanel();content.innerHTML='';content.appendChild($el('div',null,$el('strong',null,'HTML Tool')));const fileInput=$el('input',{type:'file',multiple:true,accept:'.html,.htm,.css,.js,text/html,text/css,application/javascript'});const chooseBtn=$el('button',{onclick:()=>fileInput.click()},'Choose files');content.appendChild($el('div',null,chooseBtn));const editorWrap=$el('div',{style:{marginTop:'8px'}});content.appendChild(editorWrap);const fileList=[];fileInput.addEventListener('change',async e=>{const files=Array.from(e.target.files||[]);editorWrap.innerHTML='';fileList.length=0;for(const f of files){const txt=await f.text();const ta=$el('textarea',{style:{width:'100%',height:'160px',fontFamily:'monospace',fontSize:'13px'}},txt);const lbl=$el('div',null,$el('strong',null,f.name));const downBtn=$el('button',{onclick:()=>downloadBlob(new Blob([ta.value],{type:'text/plain'}),f.name)},'Download file');editorWrap.appendChild(lbl);editorWrap.appendChild(ta);editorWrap.appendChild(downBtn);editorWrap.appendChild($el('hr'));fileList.push({name:f.name,ta});}const zipBtn=$el('button',{onclick:async ()=>{const JSZipObj=await ensureJSZip().catch(()=>null);if(!JSZipObj){alert('Failed to load JSZip');return;}const zip=new JSZipObj();for(const f of fileList)zip.file(f.name,f.ta.value);const b=await zip.generateAsync({type:'blob'});downloadBlob(b,'htmltool-files.zip');}},'Download all as ZIP');const mergeBtn=$el('button',{onclick:()=>{let merged='<!doctype html><html><head><meta charset=\"utf-8\">';for(const f of fileList)if(f.name.match(/\\.css$/i))merged+='<style>'+f.ta.value+'</style>';merged+='</head><body>';for(const f of fileList)if(f.name.match(/\\.html?$/i))merged+=f.ta.value;for(const f of fileList)if(f.name.match(/\\.js$/i))merged+='<script>'+f.ta.value+'<\\/script>';merged+='</body></html>';downloadBlob(new Blob([merged],{type:'text/html'}),'merged.html');}},'Merge to single HTML');const runBtn=$el('button',{onclick:()=>{let merged='<!doctype html><html><head><meta charset=\"utf-8\">';for(const f of fileList)if(f.name.match(/\\.css$/i))merged+='<style>'+f.ta.value+'</style>';merged+='</head><body>';for(const f of fileList)if(f.name.match(/\\.html?$/i))merged+=f.ta.value;for(const f of fileList)if(f.name.match(/\\.js$/i))merged+='<script>'+f.ta.value+'<\\/script>';merged+='</body></html>';const w=window.open();if(!w){alert('Popup blocked.');return;}w.document.open();w.document.write(merged);w.document.close();}},'Preview (open new tab)');editorWrap.appendChild($el('div',{style:{marginTop:'8px'}},zipBtn,mergeBtn,runBtn));});}function openMiniGamesPanel(){const content=createPanel();content.innerHTML='';content.appendChild($el('div',null,$el('strong',null,'Mini Games Placeholder')));for(let i=1;i<=5;i++){const slotWrap=$el('div',{style:{marginTop:'10px',padding:'8px',border:'1px solid #ddd',borderRadius:'6px'}});slotWrap.appendChild($el('div',null,$el('strong',null,'Game '+i)));const ta=$el('textarea',{style:{width:'100%',height:'120px',fontFamily:'monospace'}},'html-is-here!-here!-here!');const runBtn=$el('button',{onclick:()=>{const html=ta.value;const w=window.open();if(!w){alert('Popup blocked');return;}w.document.open();w.document.write(html);w.document.close();}},'Run this game (new tab)');const saveBtn=$el('button',{onclick:()=>downloadBlob(new Blob([ta.value],{type:'text/html'}),'mini-game-'+i+'.html')},'Download game HTML');slotWrap.appendChild(ta);slotWrap.appendChild($el('div',{style:{marginTop:'6px'}},runBtn,saveBtn));content.appendChild(slotWrap);} }const GAMES=[`<!doctype html><html><head><meta charset="utf-8"><title>Game1</title></head><body><h1>Game 1</h1><p>html-is-here!-here!-here!</p></body></html>`,`<!doctype html><html><head><meta charset="utf-8"><title>Game2</title></head><body><h1>Game 2</h1><p>html-is-here!-here!-here!</p></body></html>`,`<!doctype html><html><head><meta charset="utf-8"><title>Game3</title></head><body><h1>Game 3</h1><p>html-is-here!-here!-here!</p></body></html>`,`<!doctype html><html><head><meta charset="utf-8"><title>Game4</title></head><body><h1>Game 4</h1><p>html-is-here!-here!-here!</p></body></html>`,`<!doctype html><html><head><meta charset="utf-8"><title>Game5</title></head><body><h1>Game 5</h1><p>html-is-here!-here!-here!</p></body></html>`];function showGameOverlay(html){const existing=document.getElementById('ae_game_overlay');if(existing)existing.remove();const ov=document.createElement('div');ov.id='ae_game_overlay';Object.assign(ov.style,{position:'fixed',left:0,top:0,width:'100%',height:'100%',zIndex:2147483647,background:'rgba(0,0,0,0.75)',display:'flex',alignItems:'center',justifyContent:'center'});const ifr=document.createElement('iframe');ifr.setAttribute('sandbox','allow-scripts allow-forms allow-same-origin allow-modals');ifr.style.width='100%';ifr.style.height='100%';ifr.style.border='0';try{ifr.srcdoc=html;}catch(e){ifr.src='data:text/html;charset=utf-8,'+encodeURIComponent(html);}const closeBtn=document.createElement('button');closeBtn.textContent='Close';Object.assign(closeBtn.style,{position:'absolute',top:'12px',right:'12px',zIndex:2147483650,padding:'8px 10px',fontSize:'14px'});closeBtn.addEventListener('click',()=>{ov.remove();});const container=document.createElement('div');Object.assign(container.style,{position:'relative',width:'100%',height:'100%'});container.appendChild(ifr);container.appendChild(closeBtn);ov.appendChild(container);document.documentElement.appendChild(ov);setTimeout(()=>{try{ifr.contentWindow&&ifr.contentWindow.focus&&ifr.contentWindow.focus();}catch(_){}},200);}async function openMainMenu(){const m1=menuPrompt('Select Mode',['This Page','Other Page','Other Thing']);if(!m1)return;if(m1===1){const m2=menuPrompt('This Page Menu',['Assets List','Assets DL [here]']);if(!m2)return;if(m2===1){const assets=await scanCurrentPage();renderAssetsListPanel(assets,'This Page — Assets List');return;}if(m2===2){const assets=await scanCurrentPage();const proceed=confirm('About to attempt to download '+assets.length+' assets as ZIP. This may fail for external files due to CORS. Proceed?');if(!proceed)return;await zipAssetsAndDownload(assets);return;}}if(m1===2){const m2=menuPrompt('Other Page Menu',['Assets DL [URL]','Web See']);if(!m2)return;if(m2===1){const url=prompt('Enter URL to fetch and zip (include https://):','');if(!url)return;try{const assets=await fetchPageAndExtractAssets(url);renderAssetsListPanel(assets,'Other Page — Assets List for '+url);}catch(e){alert('Failed to fetch/parse URL: '+(e.message||e));}return;}if(m2===2){const url=prompt('Enter URL to Web See (fetch and open offline-ish view):','');if(!url)return;try{await webSee(url);}catch(e){alert('Web See failed: '+(e.message||e));}return;}}if(m1===3){const m2=menuPrompt('Other Thing Menu',['HTML Tool','Mini Games']);if(!m2)return;if(m2===1){openHTMLToolPanel();return;}if(m2===2){const g=menuPrompt('Mini Games: choose',['1game','2game','3game','4game','5game']);if(!g)return;const idx=g-1;const html=GAMES[idx]||'<!doctype html><html><body>html-is-here!-here!-here!</body></html>';showGameOverlay(html);return;}}}injectStartButton();})();})();
